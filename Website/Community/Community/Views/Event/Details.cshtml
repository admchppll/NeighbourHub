@model Community.Models.Event
@using Community.Helpers
@using Microsoft.AspNet.Identity;

@{
    ViewBag.Title = "Details";
    ViewBag.SocialImage = Model.PictureURL;
    var userid = User.Identity.GetUserId();
}
@Html.AntiForgeryToken()
<div class="col-xs-12 event-links">
    @if (VolunteerHelper.isHost(userid, Model.ID))
    {
        Html.ActionLink("Edit", "Edit", new { id = Model.ID });
    }
    <!-- Need to find better way to do this due to search functionality-->
    @Html.ActionLink("Back to List", "Index")
    <a href="javascript:history.back()">Go Back</a>
</div>
<div class="col-xs-12 col-md-7">
    <div class="col-xs-12">
        <h2>@Html.DisplayFor(model => model.Title)</h2>
    </div>
    <div class="col-xs-12">
        <div id="volunteerInfo" class="row">
            <div class="col-xs-12 col-sm-6">
                <b>Volunteers Needed:</b> @Html.DisplayFor(model => model.VolunteerQuantity)
            </div>
            <div class="col-xs-12 col-sm-6">
                <b>Points Per Volunteer:</b> @VolunteerHelper.getVolunteerPointValue(Model.ID).ToString()
            </div>
        </div>
        <p id="longDescription">
            @Html.Raw(Model.LongDescription)
        </p>
        @if (Model.PictureURL != null && Model.PictureURL != "")
        {
            <div class="col-xs-12">
                <img src="@Url.Content(Model.PictureURL)" class="img-responsive" />
            </div>
        }
    </div>
    <div class="col-xs-12">
        @if (VolunteerHelper.isHost(userid, Model.ID) || UserHelper.isAdmin(userid))
        {
            Html.RenderAction("Volunteers", "Volunteer", new { eventId = Model.ID });
        }
    </div>
</div>
<div id="eventSidebar" class="col-xs-12 col-md-5">
    @if (VolunteerHelper.isHost(userid, Model.ID) == false
        && VolunteerHelper.isVolunteer(userid, Model.ID) == false
        && VolunteerHelper.isWithdrawn(userid, Model.ID) == false
        && UserHelper.isAdmin(userid) == false
        && User.Identity.IsAuthenticated)
    {
        <div class="col-xs-12">
            <div class="row">
                @if (VolunteerHelper.isVolunteer(userid, Model.ID) == false)
                {
                    <button id="volunteerBtn" href="javascript:void();" onclick="volunteer(@Html.Raw(Model.ID))" class="btn btn-primary">Volunteer</button>
                }
                else if (VolunteerHelper.isWithdrawn(userid, Model.ID) == false)
                {
                    <button id="withdrawBtn" href="javascript:void();" onclick="withdraw(@Html.Raw(Model.ID))" class="btn btn-warning">Withdraw</button>
                }
            </div>
            <div class="row">
                <div class="col-xs-12 alert hidden" id="volunteerMessage">
                    <strong id="volunteerMsgTitle"></strong>
                    <span id="volunteerMsgContent"></span>
                </div>
            </div>
        </div>
    }

    <div class="col-xs-12">
        <h3>Date Information</h3>
        <div class="col-xs-12">
            <p>
                @Model.Date.ToString("dddd d MMMM yyyy")
                <br />
                @{DateTime time = DateTime.Parse(Model.Time.ToString());}
                @time.ToString("h:mm tt")
                <br />
                @Html.DisplayFor(model => model.Length) Hours
                <br />
                <!--Distance still needs to be added-->
                Distance: X.X miles 
            </p>
        </div>

        @if (Model.DateInfo != "")
        {
            <div class="col-xs-12">
                <h4>Extra Information</h4>
                <p>@Html.DisplayFor(model => model.DateInfo)</p>
            </div>
        }
    </div>
    @if (VolunteerHelper.isApprovedVolunteer(userid, Model.ID) || UserHelper.isAdmin(userid))
    {
        //Only provide address to approved volunteers
        <div class="col-xs-12">
            <h3>Address</h3>
            <address>
                @Html.DisplayFor(model => model.Address.Address1)<br />
                @if (!String.IsNullOrEmpty(Model.Address.Address2))
                {
                    @Html.DisplayFor(model => model.Address.Address2)<br />
                }
                @Html.DisplayFor(model => model.Address.City)<br />
                @if (!String.IsNullOrEmpty(Model.Address.County))
                {
                    @Html.DisplayFor(model => model.Address.County)<br />
                }
                @Html.DisplayFor(model => model.Address.Postcode)<br />
            </address>
            @if (!String.IsNullOrEmpty(Model.Address.Notes))
            {
                <div class="col-xs-12">
                    <h4>Things you should know</h4>
                    <p>@Html.DisplayFor(model => model.DateInfo)</p>
                </div>
            }
        </div>
    }
    <div class="col-xs-12">
        @{
            Html.RenderAction("Display", "EventTag", new { eventId = Model.ID });
        }
    </div>
</div>
@Scripts.Render("~/Scripts/Volunteer.js")
